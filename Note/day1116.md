연습) 극장별 상영관 수
```
select 극장이름, count(*) from 극장, 상영관
where 극장.극장번호 = 상영관.극장번호 
group by 극장이름 ;
```
```
극장이름     COUNT(*)
---------- ----------
CGV                 2
독립                2
롯데                1
대한                2
```
연습) 잠실에 있는 극장의 상영관
`select * from 상영관 where 극장번호 in (select 극장번호 from 극장 where 위치 = '잠실');`
```
극장번호 상영관번호 영화제목            가격     좌석수
-------- ---------- --------------- -------- ----------
       1          1 어려운 영화       15,000         48
       3          1 멋진 영화          7,500        120
       3          2 재밌는 영화        8,000        110
```
연습) 2014년 9월 1일의 극장별 평균 관람 고객 수
2014년 9월 1일 날짜에 '대한'극장에서 상영하는 영화가 A,B,C 상영된다고 가정
A 10
B 10
C 10
만약 '대한'극장에서 상영하는 영화의 수가 3개이고 각 영화별 관람고객수가 위와 같다면
이 극장의 9월 1일날 평균관람고객수는 10이 됌 
1) 2014년 9월 1일 날짜에 대한극장에서 상영하는 상영관의 수 cnt
```
A
select count(distinct 상영관.상영관번호) cnt from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01' and
극장이름 = '대한';
```
```
COUNT(DISTINCT상영관.상영관번호)
--------------------------------
                               2
```

2) 2014년 9월 1일 날짜에 대한극장의 총 관람수 sum

```
B
select count(*) sum from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01' and
극장이름 = '대한';
```
```
  SUM
----------
      5
```

3) 2014년 9월 1일 대한극장의 평균 관람 고객수 sum/cnt
```
select count(*) / count(distinct 상영관.상영관번호) from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01' and
극장이름 = '대한';
```

연습) 2014년 9월 1일에 가장 많은 고객이 관람한 영화
1)2014년 9월 1일 날짜에 영화별로 관람수 출력
```
select 영화제목, count(*)
from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01'
group by 영화제목;
```
```
영화제목          COUNT(*)
--------------- ----------
어려운 영화              1
멋진 영화                1
재밌는 영화              4
```
2)2014년 9월 1일 날짜에 영화별 관람수의 최댓값
```
select max(count(*))
from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01'
group by 영화제목;
```
```
MAX(COUNT(*))
-------------
            4
```
3) 가장 많은 고객이 관람한 영화
```
select 영화제목, count(*)
from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01'
group by 영화제목;
having count(*) = (select max(count(*))
from 극장, 상영관, 예약
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
날짜 = '2014/09/01'
group by 영화제목);
```
```
영화제목          COUNT(*)
--------------- ----------
재밌는 영화              4
```

연습) 각 테이블에 데이터를 삽입하는 insert문 실행
```
insert into 극장 values(4,'CGV','일산');
insert into 상영관 values(4,3,'슬픈 영화',10000,130);
insert into 상영관 values(4,4,'노잼 영화',5000,160);
insert into 고객 values(1,'김유신','일산');
insert into 고객 values(10,'박성미','강남');
insert into 예약 values(4,4,6,20,'2021/11/15');
insert into 예약 values(4,4,10,30,sysdate);
```

연습) '박성미' 고객이 오늘 날짜에 예약한 영화제목, 극장이름, 좌석번호를 출력

```
select 영화제목, 극장이름, 좌석번호 from 극장, 상영관, 예약,고객
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
예약.고객번호 = 고객.고객번호 and
이름 = '박성미' 
```
```
영화제목        극장이름   좌석번호
--------------- ---------- --------
노잼 영화       CGV              30
재밌는 영화     대한              1
```

실험) 오늘 날짜 검색

```
select 영화제목, 극장이름, 좌석번호 from 극장, 상영관, 예약,고객
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
예약.고객번호 = 고객.고객번호 and
이름 = '박성미' and
날짜 = '2021/11/16';
```
```
영화제목        극장이름   좌석번호
--------------- ---------- --------
노잼 영화       CGV              30
```

**sysdate으로 insert한 레코드는 출력되지 않음**

sysdate에는 날짜뿐만아니라 시,분,초에 대한 정보도 가지고 있음

시,분,초가 달라서 검색이 되지 않음!!!

to_char(날짜,'yyyy/mm/dd') 형식지정 문자 사용해야함

```
select 영화제목, 극장이름, 좌석번호 from 극장, 상영관, 예약,고객
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
예약.고객번호 = 고객.고객번호 and
이름 = '박성미' and
to_char(날짜,'yyyy/mm/dd') = '2021/11/16';
```

연습) 영화의 가격을 10%씩 인상
```
극장번호 상영관번호 영화제목            가격     좌석수
-------- ---------- --------------- -------- ----------
       4          3 슬픈 영화         10,000        130
       4          4 노잼 영화          5,000        160
       5          1 공포 영화          7,000         50
       5          2 보통 영화          8,000         80
       1          1 어려운 영화       15,000         48
       3          1 멋진 영화          7,500        120
       3          2 재밌는 영화        8,000        110
```

`update 상영관 set 가격 = 가격*1.1`
```
극장번호 상영관번호 영화제목            가격     좌석수
-------- ---------- --------------- -------- ----------
       4          3 슬픈 영화         11,000        130
       4          4 노잼 영화          5,500        160
       5          1 공포 영화          7,700         50
       5          2 보통 영화          8,800         80
       1          1 어려운 영화       16,500         48
       3          1 멋진 영화          8,250        120
       3          2 재밌는 영화        8,800        110
```

새로추가할 주문의 주문번호는 
select max(orderid)+1 from orders;

연습)

사용자한테 극장이름을 입력받아 그 극장에서 오늘 날짜에 상영하는 상영관정보를 모두 출력하는 웹문서 작성

1) '대한'극장에서 오늘 날짜에 상영하는 상영관 정보를 모두 출력
```
select 상영관.극장번호, 상영관.상영관번호, 영화제목, 가격, 좌석수 
from 극장, 상영관, 예약 
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.상영관번호 and
극장이름 = '대한' and
to_char(날짜, 'yyyy/mm/dd') = to_char(sysdate, 'yyyy/mm/dd');
```
```
극장번호 상영관번호 영화제목            가격     좌석수
-------- ---------- --------------- -------- ----------
       3          2 재밌는 영화        8,800        110
       3          3 즐거운 자바        9,000        100
       3          3 즐거운 자바        9,000        100
       3          3 즐거운 자바        9,000        100
```

2) 예약테이블에서 오늘날짜에 극장번호와 상영관번호가 합쳐져서 중복되지 않도록 검색

*중복의 경우 안돼!!!!*
```
select 극장번호, 상영관번호 from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd');
```
```
극장번호 상영관번호
-------- ----------
       4          4
       3          2
       3          3
       3          3
       3          3
```
*중복되지 않도록 검색*
```
select distinct 극장번호 , 상영관번호 from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd');
```
```
극장번호 상영관번호
-------- ----------
       4          4
       3          2
       3          3

=> A로 둠
```

3) "상영관"테이블로 부터 극장번호와 상영관번호가 합쳐져서 A에 해당하는 레코드를 검색
```
select * from 상영관 
where (극장번호, 상영관번호) in ( select distinct 극장번호 , 상영관번호 
from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd'));
```
4) '대한' 극장에서 오늘 상영한 영화의 정보
```
select 상영관.극장번호, 상영관.상영관번호, 영화제목, 가격, 좌석수  from 상영관, 극장
where (상영관.극장번호, 상영관.상영관번호) in ( select distinct 극장번호 , 상영관번호 
from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd')) and
상영관.극장번호 = 극장.극장번호 and 
극장이름 = '대한';
```
```
극장번호 상영관번호 영화제목            가격     좌석수
-------- ---------- --------------- -------- ----------
       3          2 재밌는 영화        8,800        110
       3          3 즐거운 자바        9,000        100
```
```
insert into 예약 values (3,2,8,30,sysdate);
insert into 상영관 values (3,3,'즐거운 자바',9000,100);
insert into 예약 values (3,3,1,1,sysdate);
insert into 예약 values (3,3,2,2,sysdate);
insert into 예약 values (3,3,3,3,sysdate);
insert into 예약 values (3,2,9,1,sysdate); 
insert into 예약 values (3,2,1,2,sysdate); 
```

연습)

사용자한테 극장이름을 입력받아 그 극장의 오늘날짜의 총 수입을 출력하는 웹문서 작성

1.대한극장의 상영관별 금액과 예약건수를 출력

1)극장번호, 상영관번호로 부터 예약건수 출력
```
select 극장번호, 상영관번호, count(*) from 예약
group by 극장번호, 상영관번호 
order by 극장번호, 상영관번호;
```

2)오늘날짜의 대한극장 극장번호별, 상영관번호별로 예약건수를 출력

```
select 극장번호, 상영관번호, count(*) 
from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd') and
극장번호 = (select 극장번호 from 극장 where 극장이름 = '대한')
group by 극장번호, 상영관번호 
order by 극장번호, 상영관번호;
```

```
극장번호 상영관번호   COUNT(*)
-------- ---------- ----------
       3          2          1
       3          3          2
```

2 '대한'극장의 오늘날짜의 총수익을 출력 (영화예약횟수 * 가격)

1)영화예약횟수 출력

```
select 극장번호, 상영관번호, count(*), 
(select 가격 from 상영관 where 예약.극장번호 = 상영관.극장번호 and 
예약.상영관번호 = 상영관.상영관번호) 
from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd') and
극장번호 = (select 극장번호 from 극장 where 극장이름 = '대한')
group by 극장번호, 상영관번호 
order by 극장번호, 상영관번호;
```

```
극장번호 상영관번호   COUNT(*)  (SELECT가격FROM상영관WHERE예약.극장번호=상영관.극장번호AND예약.상영관번호=상영관
--------------------------------------------------------------------------------
       3          2          1                   8800
       3          3          2                   9000
```

2)영화예약횟수 * 가격 = 수익

```
select count(*)* 
(select 가격 from 상영관 where 예약.극장번호 = 상영관.극장번호 and 
예약.상영관번호 = 상영관.상영관번호) 
from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd') and
극장번호 = (select 극장번호 from 극장 where 극장이름 = '대한')
group by 극장번호, 상영관번호 
order by 극장번호, 상영관번호;
```

```
COUNT(*)*(SELECT가격FROM상영관WHERE예약.극장번호=상영관.극장번호AND예약.상영관번
--------------------------------------------------------------------------------
                                                                            8800
                                                                           18000
```

3)영화예약횟수 * 가격의 총합계 = 총수익

```
select sum(count(*)* 
(select 가격 from 상영관 where 예약.극장번호 = 상영관.극장번호 and 
예약.상영관번호 = 상영관.상영관번호)) total
from 예약
where to_char(날짜,'yyyy/mm/dd') = to_char(sysdate,'yyyy/mm/dd') and
극장번호 = (select 극장번호 from 극장 where 극장이름 = '대한')
group by 극장번호, 상영관번호 
order by 극장번호, 상영관번호;
```
```
   TOTAL
----------
     26800
```

팀별연습문제)

사용자한테 고객이름을 입력받아 (일찍끝나면 고객이름을 콤보박스로 선택하도록 만듬)

그 고객이 예약한 극장이름, 상영관번호, 영화이름,예약일, 좌석번호, 가격을 출력하는 웹문서 작성

```
select 극장이름, 상영관.상영관번호, 영화제목, 날짜, 좌석번호, 가격 
from 극장, 상영관, 예약 
where 극장.극장번호 = 상영관.극장번호 and
상영관.극장번호 = 예약.극장번호 and
상영관.상영관번호 = 예약.극장번호 and
고객번호 = (select 고객번호 from 고객 where 이름 = ?)
```

# 예습
## 오라클의 sequence
자동적으로 증가하는 순번을 반환하는 데이터베이스의 객체

pk값의 중복을 방지하기 위해 사용

자동으로 게시글의 글 번호를 부여하는 것

## 시퀀스 생성
```
create sequence[시퀀스명] increment by [증감숫자] 양수면 증가 음수면 감소 디폴트는 1
start with [시작숫자] 시작숫자의 디폴트값은 증가일때 MINVALUE 감소일때 MAXVALUE
nominvalue or minvalue [최솟값] 
- NOMINVALUE : 디폴트값 설정, 증가일때 1, 감소일때 -1028 
- MINVALUE : 최소값 설정, 시작숫자와 작거나 같아야하고 MAXVALUE보다 작아야함
nomaxvalue or maxvalue [최대값]
- NOMINVALUE : 디폴트값 설정, 증가일때 1, 감소일때 -1028 
- MINVALUE : 최소값 설정, 시작숫자와 작거나 같아야하고 MAXVALUE보다 작아야함
CYCLE OR NOCYCLE 
-CYCLE 설정시 최대값에 도달하면 최소값부터 다시 시작 
-NOCYCLE 설정시 최대값 생성 시 시퀀스 생성중지
CACHE OR NOCACHE 
-CACHE 설정시 메모리에 시퀀스 값을 미리 할당 
시퀀스값의 액세스 효율이 Cache를 사용하지 않았을때보다 증가 
-NOCACHE 설정시 시퀀스값을 메로리에 할당하지 않음
```

## 예제
```
CREATE SEQUENCE EX_SEQ --시퀀스이름 EX_SEQ
INCREMENT BY 1 --증감숫자 1
START WITH 1 --시작숫자 1
MINVALUE 1 --최소값 1
MAXVALUE 1000 --최대값 1000
NOCYCLE --순한하지않음
CACHE; --메모리에 시퀀스값 미리할당
```

## 시퀀스 수정
시퀀스는 DDL문이므로 ALTER문을 사용하여 수정 가능 , 시작값은 수정 불가능

현재 들어있는 값보다 높은 최솟값(감소 시퀀스일 경우 그 반대)로도 설정 불가능

## 시퀀스 삭제
`DROP SEQUENCE [시퀀스명]`

# 오라클의 rownum 
페이징하기 위해서 알아야하는 것...

ROW NUM 출력되는 결과물에 순차적인 번호를 달아주는 기능

조회된 레코드row의 number순서값을 가지는 가상의 컬럼

rownum은 조회하는 순간에 자동으로 생성

page 처리와 N-top 조회에 많이 사용 
