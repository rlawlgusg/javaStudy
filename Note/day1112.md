# 과제
과제)

'박지성'이 구매하지 않은 도서명을 모두 출력

1) 고객 테이블로 부터 이름이 박지성인 고객번호 검색

`select custid from customer where name = '박지성';`
```
CUSTID
--------
     1
```

2) 주문테이블로 부터 고객번호가 1인 고객이 주문한 도서번호들을 검색

`select bookid from orders where custid =  (select custid from customer where name = '박지성');`
```
BOOKID
------
    13
     1
     3
     2
```

3) 도서테이블로 부터 도서번호가 (1,3,2,13)이 아닌 도서이름들을 출력

`select bookname from book where bookid not in (select bookid from orders where custid =  (select custid from customer where name = '박지성'));`

연습) 

주문하지 않은 고객의 이름 출력

1) 주문테이블로 부터 고객번호를 출력

`select distinct custid from orders;`
```
CUSTID
------
     6
     7
     1
     2
     3
     4
```
2)고객 테이블로부터 고객번호가 (1,2,3,4,6,7)번이 아닌 고객의 이름 출력

`select name from customer where custid not in (select distinct custid from orders);`
```
NAME
----------
박세리
```

연습)

두 개 이상의 서로 다른 출판사에서 도서를 구매한 고객의 이름 출력

1)고객별로 구매한 출판사의 수를 출력
```
select name, count(distinct publisher) cnt 
from A book b, customer c, orders o 
where c.custid = o.custid and
b.bookid = o.bookid 
group by name; 
```
위의 sql을 A로 함

2)cnt가 2이 이상인 고객의 이름을 출력
```
select name from (select c.name, count(distinct publisher) cnt 
from A book b, customer c, orders o 
where c.custid = o.custid and
b.bookid = o.bookid 
group by c.name) A
where A.cnt >=2;
```
NAME
----------
윤석열
박지성
김연아
장미란
```

연습)

박지성이 구매한 도서의 출판사 수 출력
1) join 이용
```
select count(distinct publisher) 
from book b, customer c, orders o
where c.custid = o.custid and
b.bookid = o.bookid and 
name = '박지성';
```
2)서브쿼리 이용
`select custid from customer where name = '박지성';`

`select bookid from orders where custid = ( select custid from customer where name = '박지성');`

```
select count(distinct publisher) from book 
where bookid in (  select bookid from orders 
where custid = ( select custid from customer 
where name = '박지성'));
```

연습)

윤석열에게 추천할 도서 이름 출력
윤석열이 구매한 도서와 동일한 도서를 가장 많이 구매한 사람이 구매한 도서중에 윤석열이 구매하지 않은 도서이름을 출력 

```
select ~~ from 테이블1, left outer join 테이블2 and 다른조건식 
다른조건식이 and로 적용되지 않음, 서브쿼리가 필요함!
select ~~ from 테이블1, 테이블 where 조인식+ and 다른조건식 
다른조건식이 and로 적용됌, +기호는 오라클에만 있음 
```

## 다중행연산자

서브쿼리가 where절에 사용이 될 때에 서브쿼리의 건수가 여러건일 때 사용하는 연산자 


연습)
박지성의 총 구매액
`select custid from customer where name = '박지성';`

```
select sum(saleprice) from orders 
where custid = (select custid from customer where name = '박지성');
```

연습) 

박지성이 구매한 도서의 이름, 가격, 정가와 판매가격의 차이
```
select bookname, price, price-saleprice from book b, orders o, customer c
where b.bookid = o.bookid and
o.custid = c.custid and 
name = '박지성';
```
```
BOOKNAME                PRICE PRICE-SALEPRICE
-------------------- -------- ---------------
재미있는 오라클        50,000            1000
축구의 역사             7,000            1000
축구아는 여자          13,000            1000
축구의 이해            22,000            1000
```

**음수이던 양수이던 절댓값을 구해주는 함수 abs**
```
select bookname, price, abs(saleprice-price) from book b, orders o, customer c
where b.bookid = o.bookid and
o.custid = c.custid and 
name = '박지성';
```
```
BOOKNAME                PRICE ABS(SALEPRICE-PRICE)
-------------------- -------- --------------------
재미있는 오라클        50,000                 1000
축구의 역사             7,000                 1000
축구아는 여자          13,000                 1000
축구의 이해            22,000                 1000
```

연습) 

마당 서점의 도서의 총 개수
```
select count(bookid) from book;
= select count(*) from book;
```

**count(*)은 모든 레코드 출력**

연습) 

마당 서점에 도서를 출고하는 출판사의 총 개수

`select count(distinct publisher) from book;`

연습)

도서의 가격과 판매가격의 차이가 가장 많은 주문
-도서의 가격과 판매가격 차이의 최대값
```
select abs(price-saleprice) from book b, orders o 
where b.bookid = o.bookid;
```
```
ABS(PRICE-SALEPRICE)
--------------------
                1000
                1000
                1000
                   0
                   0
                   0
                   0
                1000
                   0
                1000
                6000
                   0
                1000
                   0
```
```
select max(abs(price-saleprice)) from book b, orders o 
where b.bookid = o.bookid;
```
```
MAX(ABS(PRICE-SALEPRICE))
-------------------------
                     6000
```

-도서의 가격과 판매가격의 차이가 6000원인 주문번호
```
select orderid from orders o, book b 
where o.bookid = b.bookid and
abs(price - saleprice) = ( select max(abs(price-saleprice)) from book b, orders o 
where b.bookid = o.bookid);
```
```
ORDERID
-------
      9
```

-주문 번호가 9번인 주문내역을 출력
```
select * from orders where orderid = (select orderid from orders o, book b 
where o.bookid = b.bookid and
abs(price - saleprice) = ( select max(abs(price-saleprice)) from book b, orders o 
where b.bookid = o.bookid));
```
```
ORDERID CUSTID BOOKID SALEPRICE ORDERDATE
------- ------ ------ --------- ---------------
      9      2     10     7,000 21/11/09
```

연습)

도서의 판매액 평균보다 자신의 구매액 평균이 더 높은 고객의 이름

-도서의 판매액 평균

`select avg(saleprice) from orders;`
```
AVG(SALEPRICE)
--------------
    17928.5714
```

-고객 id별 구매액 평균을 출력
```
select custid, avg(saleprice) avg from orders 
group by custid;
```
```
CUSTID AVG(SALEPRICE)
------ --------------
     6          32000
     7          20000
     1          22000
     2           7500
     3     10333.3333
     4          16500		>>A
```

-A중에서 A의 평균 17928.5714보다 높은 고객번호를 검색 
```
select custid from (select custid, avg(saleprice) avg from orders 
group by custid) A 
where A.avg > (select avg(saleprice) from orders);
```
```
CUSTID
------
     6
     7
     1
```

-고객번호가 1,6,7에 해당하는 고객의 이름 출력
```
select name from customer 
where custid in (select custid from (select custid, avg(saleprice) avg from orders 
group by custid) A 
where A.avg > (select avg(saleprice) from orders));
```
```
NAME
----------
윤석열
이재명
박지성
```

연습) 

모든 직원의 이름과 직위를 출력

`select ename,job from emp;`
 
연습) 

30번 부서에 근무하는 모든 사원의 이름과 급여를 출력
```
select ename, salary from emp e, dept d 
where e.dno = d.dno and
d.dno = 30 and 
e.job = '사원';
```
연습) 

개발팀에 근무하는 모든 사원의 이름과 급여를 출력

1)join이용
```
select ename, salary from emp e, dept d
where e.dno = d.dno and 
d.dname like '개발%' ;
```
2)서브쿼리 이용
```
select ename, salary from emp 
where dno in (select dno from dept where dname like '개발%');
```
연습) 

직급별로 동일한 직급의 직원수를 출력
```
select job, count(*) from emp 
group by job;
```

연습) 

20번 부서의 구성원 수와 직원들의 급여의 합계와 평균을 출력
```
select count(*), sum(salary), avg(salary) 
from emp 
where dno = 20;
```
연습) 

개발 1팀에 근무하는 직원들의 구성원 수와 직원들의 급여의 합계와 평균을 출력
```
select count(eno), sum(salary), avg(salary) from emp e, dept d
where e.dno = d.dno and
d.dname = '개발1팀';
```
```
select count(eno), sum(salary), avg(salary) from emp
where d.dno = (select dno from dept where dname = '개발1팀');
```

연습) 

서교동에 근무하는 직원들의 구성원 수와 직원들의 급여의 합계와 평균을 출력

```
select count(eno), sum(salary), avg(salary) from emp e, dept d
where e.dno = d.dno and
d.dloc = '서교동';
```
```
select count(*), sum(salary), avg(salary) from emp 
where dno in (select dno from dept where dloc = '서교동');
```
연습)

평균급여가 가장 높은 부서번호를 출력
```
select d.dname, avg(salary) from emp e, dept d 
where e.dno=d.dno 
group by d.dname;
```

-부서번호별로 평균급여를 출력

`select dno, avg(salary) avg from emp group by dno;`
```
  DNO AVG(SALARY)
----- -----------
   30  596.666667
   10         530
   20       532.5		>>A
```

-부서별 평균급여의 최대값 출력

`select max(avg(salary)) from emp group by dno;`
```
MAX(AVG(SALARY))
----------------
      596.666667
```

-A중에서 평균급여가 max인 부서번호를 출력
```
select dno from (select dno, avg(salary) avg from emp group by dno) A 
where A.avg = (select max(avg(salary)) from emp group by dno);
```
```
  DNO
-----
   30
```

연습)

평균급여가 가장 높은 부서명을 출력
```
select dname from dept
where dno in ( select dno from (select dno, avg(salary) avg from emp group by dno) A 
where A.avg = (select max(avg(salary)) from emp group by dno));
```
```
DNAME
----------
기획팀
```

연습)

평균급여가 가장 높은 부서에 근무하는 직원들의 이름을 출력
```
select ename from emp 
where dno in ( select dno from (select dno, avg(salary) avg from emp group by dno) A 
where A.avg = (select max(avg(salary)) from emp group by dno));
```
```
ENAME
----------------------------------------
이건우
윤태인
김시아
노유나
박성미
임상진
```

연습)

전체 직원들 중에 직속상관이 있는 사원의 수를 출력

`select count(*) from emp where mgr != null`
```
  COUNT(*)
----------
         0
```
잘못된 값

**null인지 물어보려면 is , is not을 확인**

`select count(*) from emp where mgr is not null`

```
  COUNT(*)
----------
        14
```

`select count(mgr) from emp;`
```
COUNT(MGR)
----------
        14
```

연습)

사원테이블에서 이름, 급여, 수당, 총액을 구하여 총액이 높은 순으로 출력 단, 수당이 null인 사람은 제외
```
select eno, salary, comm, salary+comm 
from emp 
where comm is not null
order by salary+comm desc;
```
```
 ENO    SALARY      COMM SALARY+COMM
----- --------- --------- -----------
 1000      1000       100        1100
 1001       800        80         880
 1003       800        80         880
 1002       700        70         770
 1006       600        80         680
 1005       500        80         580
 1009       500        50         550
 1004       500        50         550
 1010       430        43         473
 1008       420        42         462
 1012       420        42         462
 1007       400        40         440
 1011       380        38         418
 1013       380        38         418
14 행이 선택되었습니다.
```

연습) 

각 부서별로 같은 직급의 사람의 수를 구하여 부서번호, 직급, 사람수를 출력

연습) 직원이 한명도 없는 부서의 이름을 출력

연습) 같은 직급의 사람의 수가 2명이상인 직급과 인원수를 출력

연습) 같은 직급의 사람의 수가 2명이상인 직급과 인원수를 출력

연습)박지예보다 급여를 더 많이 받는 사람의 이름을 출력

연습)박지예가 일하는 부서 혹은 서교동에 있는 부서번호를 출력

